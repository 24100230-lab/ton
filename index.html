<!doctypehtml >
< html  lang =" vi " >
< ƒë·∫ßu >
  < meta  charset =" utf-8 " />
  < meta  name =" viewport " content =" width=device-width,initial-scale=1 " />
  < title > Th∆∞ Vi·ªán ·∫¢nh Ny T√¥i (Ho√†ng Linh) </ title >
  < li√™n k·∫øt  rel =" b·∫£ng ƒë·ªãnh ki·ªÉu " href =" style.css " />
</ ƒë·∫ßu >
< th√¢n >
  < div  class =" ·ª©ng d·ª•ng " >
    < ti√™u ƒë·ªÅ >
      <div>‚Äã‚Äã
        < h1 > Th∆∞ Vi·ªán ·∫¢nh Ny T√¥i (Ho√†ng Linh) </ h1 >
        < p > Up ·∫£nh c·ªßa ng∆∞·ªùi y√™u th√≠ch ‚Äî l∆∞u ch·ªâ tr√™n tr√¨nh duy·ªát c·ªßa b·∫°n (localStorage). </p>‚Äã‚Äã
      </div>‚Äã‚Äã
      < div  class =" small " > An to√†n & ri√™ng t∆∞ ‚Ä¢ Kh√¥ng g·ª≠i m√°y ch·ªß </ div >
    </ ti√™u ƒë·ªÅ >

    < div  class =" ng∆∞·ªùi t·∫£i l√™n " >
      < ph·∫ßn  l·ªõp =" th·∫ª-th∆∞-m·ª•c " >
        < div  class =" ƒëi·ªÅu khi·ªÉn " >
          < nh√£n  class =" btn " for =" fileInput " > Ch·ªçn ·∫£nh </ nh√£n >
          < input  id =" fileInput " class =" input-file " type =" file " accept =" image/* " multiple  />
          < n√∫t  id =" clearAll " class =" btn ghost " > X√≥a t·∫•t c·∫£ </ n√∫t >
          < div  style =" flex:1 " > </ div >
          < n√∫t  id =" downloadAll " class =" btn ghost " > T·∫£i t·∫•t c·∫£ (m·ªü tab) </ n√∫t >
        </div>‚Äã‚Äã

        < div id =" dropzone " class = " dropzone " > K√©o th·∫£ ·∫£nh v√†o ƒë√¢y ho·∫∑c nh·∫•n "Ch·ªçn ·∫£nh" < / div  >
        < div  id =" thumbGrid " class =" thumb-grid " aria-live =" l·ªãch s·ª± " > </ div >
        < div  id =" tr·ªëngState " class =" nh·ªè " > Ch∆∞a c√≥ ·∫£nh n√†o ‚Äî up one few image to started. </ div >
      </ ph·∫ßn >

      < aside  class =" preview-card " >
        < div  class =" xem tr∆∞·ªõc-big " id =" xem tr∆∞·ªõcBig " > < div  class =" nh·ªè " > Ch·ªçn m·ªôt ·∫£nh ƒë·ªÉ xem l·ªõn </ div > </ div >
        < div  class =" small " > ·∫¢nh ƒë∆∞·ª£c l∆∞u trong tr√¨nh duy·ªát b·ªô nh·ªõ (localStorage). N·∫øu b·∫°n x√≥a b·ªô nh·ªõ ƒë·ªám ho·∫∑c s·ª≠ d·ª•ng tr√¨nh duy·ªát kh√°c, ·∫£nh s·∫Ω b·ªã m·∫•t. </ div >
      </ sang m·ªôt b√™n >
    </div>‚Äã‚Äã

    < ch√¢n trang >
      < p  class =" t√°c gi·∫£ " > T√°c gi·∫£: < m·∫°nh > To√†n Nguy·ªÖn </ m·∫°nh > </ p >
    </ ch√¢n trang >
  </div>‚Äã‚Äã

  < k·ªãch b·∫£n >
    const  STORAGE_KEY  =  'th∆∞ vi·ªán ·∫£nh ri√™ng t∆∞-v1' ;
    const  fileInput  =  t√†i li·ªáu . getElementById ( 'fileInput' ) ;
    const  dropzone  =  document .getElementById ( 'dropzone ' ) ;
    const  thumbGrid  =  document .getElementById ( 'thumbGrid ' ) ;
    const  previewBig  =  document .getElementById ( 'previewBig ' ) ;
    const  emptyState  =  document.getElementById ( ' emptyState ' ) ;
    const  clearAll  =  document .getElementById ( ' clearAll' ) ;
    const  downloadAll  =  document .getElementById ( ' downloadAll' ) ;

    h√£y ƒë·ªÉ  ·∫£nh  =  loadFromStorage ( ) ;
    k·∫øt xu·∫•t ( ) ;

    fileInput .addEventListener ( 'thay ƒë·ªïi' , async ( e ) = > {  
      const  files  =  M·∫£ng . t·ª´ ( e . m·ª•c ti√™u . t·ªáp ) ;
      ch·ªù  handleFiles ( t·ªáp ) ;
      fileInput .gi√° tr·ªã  =  '' ;
    } ) ;

    [ 'ng∆∞·ªùi k√©o' , 'ng∆∞·ªùi k√©o' ] . forEach ( ev => {
      dropzone .addEventListener ( ev , ( e ) = > {
        e . preventDefault ( ) ;
        dropzone .classList .add ( ' dragover ' ) ;
      } ) ;
    } ) ;
    [ 'k√©o' , 'th·∫£' ] . forEach ( ev => {
      dropzone .addEventListener ( ev , ( e ) = > {
        e . preventDefault ( ) ;
        dropzone .classList .remove ( ' dragover ' ) ;
      } ) ;
    } ) ;

    dropzone .addEventListener ( 'drop' , async ( e ) = > {  
      const  files  =  M·∫£ng . t·ª´ ( e . truy·ªÅn d·ªØ li·ªáu . t·ªáp ) . b·ªô l·ªçc ( f => f . lo·∫°i . b·∫Øt ƒë·∫ßu v·ªõi ( 'h√¨nh ·∫£nh/' ) ) ;
      ch·ªù  handleFiles ( t·ªáp ) ;
    } ) ;

    x√≥aT·∫•t c·∫£ .addEventListener ( 'nh·∫•p' , ( ) = > { 
      if ( ! confirm ( 'X√≥a t·∫•t c·∫£ ·∫£nh kh·ªèi tr√¨nh duy·ªát b·ªô nh·ªõ?' ) )  return ;
      ·∫£nh  =  [ ] ;
      l∆∞u v√†o b·ªô nh·ªõ ( ) ;
      k·∫øt xu·∫•t ( ) ;
    } ) ;

    downloadAll .addEventListener ( 'click' , ( ) = > { 
      if ( photos . length === 0 ) { notification ( 'Ch∆∞a c√≥ ·∫£nh ƒë·ªÉ t·∫£i.' ) ; tr·ªü l·∫°i }
      ·∫£nh . forEach ( p => {
        const  w  =  c·ª≠a s·ªï . m·ªü ( p . dataUrl , '_blank' ) ;
        if ( ! w )  c·∫£nh b√°o ( 'Popup b·ªã ch·∫∑n ‚Äî cho ph√©p b·∫≠t l√™n ƒë·ªÉ t·∫£i nhi·ªÅu ·∫£nh c√πng l√∫c.' ) ;
      } ) ;
    } ) ;

     h√†m x·ª≠ l√Ω t·ªáp kh√¥ng  ƒë·ªìng b·ªô ( t·ªáp ) {
      n·∫øu ( t·ªáp . ƒë·ªô d√†i === 0 )  tr·∫£ v·ªÅ ;
      h·∫±ng s·ªë  maxFileMB  =  6 ;
      ƒë·ªëi v·ªõi ( const  f  c·ªßa  c√°c t·∫≠p tin ) {
        n·∫øu ( f . k√≠ch th∆∞·ªõc  >  maxFileMB * 1024 * 1024 ) {
          c·∫£nh b√°o ( `B·ªè qua ${ f . name } : l·ªõn h∆°n ${ maxFileMB } MB` ) ;
          Ti·∫øp t·ª•c ;
        }
        const  dataUrl  =  await  fileToDataUrl ( f ) ;
        ·∫£nh . unshift ( { id : cryptoRandomId ( ) , t√™n : f . t√™n , k√≠ch th∆∞·ªõc : f . k√≠ch th∆∞·ªõc , t·∫°o : Ng√†y . b√¢y gi·ªù ( ) , dataUrl } ) ;
      }
      l∆∞u v√†o b·ªô nh·ªõ ( ) ;
      k·∫øt xu·∫•t ( ) ;
    }

    h√†m  fileToDataUrl ( t·ªáp ) {
      tr·∫£ v·ªÅ  l·ªùi h·ª©a m·ªõi  ( ( res , rej ) => {
        const  r  =  new  FileReader ( ) ;
        r . onload  =  ( ) => res ( r . result ) ;
        r .onerror = rej ;‚Äã  
        r . readAsDataURL ( t·ªáp ) ;
      } ) ;
    }

    h√†m  render ( ) {
      thumbGrid . innerHTML = '' ;
      emptyState.style.display = photos.length === 0 ? ' block ' : ' none ' ;‚Äã‚Äã  
      ·∫£nh . forEach ( ( p , idx ) => {
        const  div  =  document .createElement ( 'div ' ) ;
        div .className = ' thumb' ;
        div . innerHTML  =  `
          <img src=" ${ p . dataUrl } " alt=" ${ escapeHtml ( p . name ) } " />
          <div class="meta">
            <div title=" ${ new  Date ( p . created ) . toLocaleString ( ) } "> ${ p . name } </div>
            <div><button class="remove" data-idx=" ${ idx } " title="X√≥a">üóë</button></div>
          </div>` ;
        thumbGrid .appendChild ( div ) ;‚Äã
      } ) ;

      thumbGrid .querySelectorAll ( '.thumb img ' ) .forEach ( ( img , i ) = > {
        h√¨nh ·∫£nh . addEventListener ( 'click' ,  ( ) => showPreview ( ·∫£nh [ i ] ) ) ;
      } ) ;
      thumbGrid .querySelectorAll ( '.remove ' ) .forEach ( btn = > {
        n√∫t .addEventListener ( 'nh·∫•p chu·ªôt' , ( ) = > { 
          const  i  =  S·ªë ( btn . getAttribute ( 'data-idx' ) ) ;
          if ( ! confirm ( 'X√≥a ·∫£nh n√†y?' ) )  return ;
          ·∫£nh . gh√©p n·ªëi ( i , 1 ) ;
          l∆∞u v√†o b·ªô nh·ªõ ( ) ;
          k·∫øt xu·∫•t ( ) ;
        } ) ;
      } ) ;
    }

    h√†m  showPreview ( item ) {
      previewBig . innerHTML  =  '' ;
      const  img  =  document .createElement ( 'img ' ) ;
      img . src  =  m·ª•c . dataUrl ;
      img . alt  =  m·ª•c . t√™n ;
      previewBig .appendChild ( img ) ;‚Äã
    }

    h√†m  saveToStorage ( ) {
      th·ª≠ {
        localStorage . setItem ( STORAGE_KEY ,  JSON . stringify ( ·∫£nh ) ) ;
      } b·∫Øt ( e ) {
        b·∫£ng ƒëi·ªÅu khi·ªÉn . error ( 'L∆∞u th·∫•t b·∫°i' ,  e ) ;
        c·∫£nh b√°o ( 'Kh√¥ng th·ªÉ l∆∞u: tr√¨nh duy·ªát b·ªô nh·ªõ ƒë√£ ƒë·∫ßy ho·∫∑c ƒëang ·ªü ch·∫ø ƒë·ªô ri√™ng t∆∞.' ) ;
      }
    }
    h√†m  loadFromStorage ( ) {
      th·ª≠ {
        const  raw  =  localStorage.getItem ( STORAGE_KEY ) ;‚Äã‚Äã
        tr·∫£ v·ªÅ  d·∫°ng th√¥ ? JSON.ph√¢n t√≠ch c√∫ ph√°p ( th√¥ ) : [ ] ;
      } b·∫Øt ( e ) {
        console.l·ªói ( e ) ;‚Äã‚Äã
        tr·ªü l·∫°i  [ ] ;
      }
    }
    h√†m  cryptoRandomId ( ) {
      tr·∫£ v·ªÅ  ( [ 1e7 ] + - 1e3 + - 4e3 + - 8e3 + - 1e11 ) . thay th·∫ø ( / [ 0 1 8 ] / g , c =>
        ( c  ^  crypto . getRandomValues ‚Äã‚Äã( new  Uint8Array ( 1 ) ) [ 0 ]  &  15  >>  c / 4 ) . toString ( 16 )
      ) ;
    }
    h√†m  escapeHtml ( s ) {
      tr·∫£ v·ªÅ  s . thay th·∫ø ( / [ & < > \" ' ] / g , c => ( { "&" : "&" , "<" : "<" , ">" : ">" , "\"" : """ , "'" : "'" } [ c ] ) ) ;
    }
    c·ª≠a s·ªï .addEventListener ( 'keydown' , ( e ) = > {
      n·∫øu ( e . key . toLowerCase ( ) === 'u' ) { fileInput . click ( ) }
    } ) ;
  </ k·ªãch b·∫£n >
</ th√¢n >
</html>
